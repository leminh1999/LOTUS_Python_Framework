version: '3.7'

networks:
    zabbix_net:
        # name: zabbix_net
        driver: bridge
        # internal: true
        ipam:
            driver: default
            config:
                - subnet: '172.20.0.0/16'
                  ip_range: '172.20.240.0/20'
    lotus_net:
        name: lotus_net
        driver: bridge
        ipam:
            driver: default
            config:
                - subnet: '100.100.0.0/16'
                  ip_range: '100.100.200.0/24'

services:
    #2. Start empty MySQL server instance
    mysql:
        container_name: mysql-server
        environment:
            - MYSQL_DATABASE=zabbix
            - MYSQL_USER=zabbix
            - MYSQL_PASSWORD=zabbix_pwd
            - MYSQL_ROOT_PASSWORD=root_pwd
        networks:
            - 'zabbix_net'
        restart: unless-stopped
        image: 'mysql:8.0'
        command: --character-set-server=utf8 --collation-server=utf8_bin --default-authentication-plugin=mysql_native_password
     
    #3. Start Zabbix Java gateway instance
    zabbix-java-gateway:
        container_name: zabbix-java-gateway
        networks: 
            zabbix_net:
            # lotus_net: #external network
            #     ipv4_address: '100.100.100.8'
        restart: unless-stopped
        image: 'zabbix/zabbix-java-gateway:alpine-6.2-latest'
    #4. Start Zabbix server instance and link the instance with created MySQL server instance
    zabbix-server-mysql:
        container_name: ZABBIX_SERVER_PYTHON
        environment:
            - DB_SERVER_HOST=mysql-server
            - MYSQL_DATABASE=zabbix
            - MYSQL_USER=zabbix
            - MYSQL_PASSWORD=zabbix_pwd
            - MYSQL_ROOT_PASSWORD=root_pwd
            - ZBX_JAVAGATEWAY=zabbix-java-gateway
        networks: 
            zabbix_net:
            lotus_net: #external network
                ipv4_address: '100.100.100.1'
        ports:
            - '10051:10051'
        restart: unless-stopped
        image: 'zabbix/zabbix-server-mysql:alpine-6.2-latest'

    #5. Start Zabbix web interface instance and link the instance with created MySQL server instance
    zabbix-web-nginx-mysql:
        container_name: zabbix-web-nginx-mysql
        environment:
            - ZBX_SERVER_HOST=zabbix-server-mysql
            - DB_SERVER_HOST=mysql-server
            - MYSQL_DATABASE=zabbix
            - MYSQL_USER=zabbix
            - MYSQL_PASSWORD=zabbix_pwd
            - MYSQL_ROOT_PASSWORD=root_pwd
        networks: 
            zabbix_net:
            # lotus_net: #external network
            #     ipv4_address: '100.100.100.9'
        ports:
            - '80:8080'
        restart: unless-stopped
        image: 'zabbix/zabbix-web-nginx-mysql:alpine-6.2-latest'

